# SPDX-FileCopyrightText: Copyright (c) 2023 - 2025 NVIDIA CORPORATION & AFFILIATES.
# SPDX-FileCopyrightText: All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
# ERA5降尺度推理配置文件
#
# =============================================================================
# 处理流程
# =============================================================================
#
#   输入: 低分辨率ERA5数据 (如25km福建区域, 20x25像素, 4个特征)
#                   ↓
#   1. 切分为低分辨率patches (如10x10像素)
#                   ↓
#   2. 每个patch双线性插值到模型输入尺寸 (256x256)
#                   ↓
#   3. 模型推理
#                   ↓
#   4. 输出缩放到对应高分辨率尺寸 (10*25=250像素)
#                   ↓
#   5. 所有patches加权融合拼接
#                   ↓
#   输出: 高分辨率ERA5数据 (1km福建区域, 500x625像素)
#
# =============================================================================
# 使用示例
# =============================================================================
#
# 福建区域25km ERA5降尺度到1km:
#
#   python inference_era5.py \
#       --input_dir ./data/era5_fujian_25km/ \
#       --output_dir ./outputs/era5_fujian_1km/ \
#       --reg_ckpt ./checkpoints/regression.mdlus \
#       --stats_path ./data/stats.json \
#       --lr_patch_size 10 10 \
#       --model_input_size 256 256 \
#       --scale_factor 25
#
# 使用扩散模型生成10个集合成员:
#
#   python inference_era5.py \
#       --input_dir ./data/era5_fujian_25km/ \
#       --output_dir ./outputs/era5_fujian_1km/ \
#       --reg_ckpt ./checkpoints/regression.mdlus \
#       --res_ckpt ./checkpoints/diffusion.mdlus \
#       --stats_path ./data/stats.json \
#       --lr_patch_size 10 10 \
#       --model_input_size 256 256 \
#       --scale_factor 25 \
#       --num_ensembles 10
#
# =============================================================================
# 参数说明
# =============================================================================
#
# 必需参数:
#   --input_dir         输入文件夹路径（包含单时间戳ERA5 nc文件）
#   --output_dir        输出文件夹路径
#
# 模型参数:
#   --reg_ckpt          回归模型检查点路径
#   --res_ckpt          扩散模型检查点路径（可选）
#   --stats_path        归一化统计信息JSON文件路径
#
# Patch参数:
#   --lr_patch_size     低分辨率patch尺寸 H W（默认: 10 10）
#                       例如: 10 10 表示每个patch覆盖10x10个低分辨率像素
#   --model_input_size  模型输入尺寸 H W（默认: 256 256）
#                       低分辨率patch会被插值到这个尺寸
#   --scale_factor      分辨率放大倍数（默认: 25）
#                       例如: 25km到1km = 25倍
#   --overlap_lr_pixels 低分辨率patch重叠像素数（默认: 1）
#                       用于减少拼接边界伪影
#
# 推理参数:
#   --num_ensembles     集合成员数量（默认: 1）
#   --num_steps         扩散采样步数（默认: 18）
#   --device            计算设备（默认: cuda）
#   --fp16              使用半精度
#
# 输出参数:
#   --save_input        在输出nc中保存输入数据
#   --file_pattern      输入文件匹配模式（默认: *.nc）
#
# =============================================================================
# 输入文件格式
# =============================================================================
#
# 每个nc文件应包含:
#   - 维度: lat/latitude, lon/longitude, (可选: time)
#   - 变量: 气象变量（如温度、风速、湿度、气压等）
#   - 单时间戳数据
#
# 示例输入尺寸（福建区域25km）:
#   - lat: 20个网格点
#   - lon: 25个网格点
#   - 变量: t2m, u10, v10, sp (4个特征)
#
# =============================================================================
# 输出文件格式
# =============================================================================
#
# 输出符合ERA5/CF-1.6规范:
#   - 文件名: {输入文件名}_downscaled.nc
#   - 维度: time, (ensemble), lat, lon
#   - 高分辨率坐标网格
#   - 可选: 保存原始低分辨率输入
#
# 示例输出尺寸（福建区域1km）:
#   - lat: 500个网格点 (20 * 25)
#   - lon: 625个网格点 (25 * 25)
#
# =============================================================================
# 边界处理
# =============================================================================
#
# 对于边界处不足完整patch尺寸的区域:
#   1. 使用反射padding填充到完整patch尺寸
#   2. 正常进行插值和推理
#   3. 拼接时只保留有效区域的输出
#   4. 使用加权融合消除拼接边界伪影
